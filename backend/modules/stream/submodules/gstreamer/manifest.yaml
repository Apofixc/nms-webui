id: gstreamer
name: "GStreamer Driver"
version: "1.0.0"
priority: 30
author: NMS-Team
description: Модуль для работы с GStreamer. Гибкий мультимедийный конвейер.
entrypoints: {}

capabilities:
  - streaming
  - preview
  - conversion

config_schema:
  type: object
  properties:
    # ── Система ──
    binary_path:
      type: string
      title: "Путь к GStreamer"
      default: "gst-launch-1.0"
      description: "Системный путь к исполняемому файлу GStreamer."
      group: "Система"

    # ── Прием (Input) ──
    udp_default_port:
      type: integer
      title: "UDP Порт приема"
      default: 5000
      description: "Порт для получения входящего потока."
      group: "Прием (Input)"
    udp_caps:
      type: string
      title: "Параметры потока (Caps)"
      default: "application/x-rtp,media=video,clock-rate=90000,encoding-name=H264"
      description: "Определение формата RTP (для экспертов)."
      group: "Прием (Input)"

    # ── Плеер (HTTP_TS) ──
    http_ts_muxer:
      type: string
      title: "Контейнер (Muxer)"
      enum: ["mpegtsmux", "matroskamux"]
      default: "mpegtsmux"
      description: "Формат упаковки для HTTP-вещания."
      group: "Плеер (HTTP_TS)"

    # ── Плеер (HLS) ──
    hls_target_duration:
      type: integer
      title: "HLS: Длительность сегмента"
      minimum: 1
      maximum: 30
      default: 5
      description: "Длина одного фрагмента видео (сек)."
      group: "Плеер (HLS)"
    hls_max_files:
      type: integer
      title: "HLS: Размер плейлиста"
      minimum: 1
      maximum: 50
      default: 5
      description: "Количество файлов в плейлисте."
      group: "Плеер (HLS)"
    hls_encoder:
      type: string
      title: "HLS: Видеокодер"
      enum: ["x264enc", "x265enc", "vp8enc"]
      default: "x264enc"
      description: "Плагин кодирования видео."
      group: "Плеер (HLS)"
    hls_encoder_args:
      type: string
      title: "HLS: Аргументы кодера"
      default: "tune=zerolatency speed-preset=superfast"
      description: "Дополнительные флаги (Advanced)."
      group: "Плеер (HLS)"

    # ── Превью ──
    preview_framerate:
      type: string
      title: "Частота кадров"
      default: "1/1"
      description: "Интервал захвата кадров (например: 1/1)."
      group: "Превью"

    # ── Экспертные настройки ──
    override_http_ts:
      type: string
      title: "Override: HTTP_TS"
      default: ""
      description: "Кастомная команда GStreamer для вещания."
      group: "Для экспертов"
    override_hls:
      type: string
      title: "Override: HLS"
      default: ""
      description: "Кастомная команда GStreamer для HLS."
      group: "Для экспертов"
    override_preview:
      type: string
      title: "Override: Preview"
      default: ""
      description: "Кастомная команда для захвата снимков."
      group: "Для экспертов"

# Поддерживаемые форматы и протоколы
formats:
  input_protocols:
    - udp
    - http
    - rtsp
  output_types:
    - http_ts
    - hls
  preview_formats:
    - jpeg
    - png

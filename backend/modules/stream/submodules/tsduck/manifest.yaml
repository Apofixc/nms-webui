id: tsduck
parent: stream
name: TSDuck Toolkit
version: 3.32.0
priority: 50
author: TSDuck Team
description: Инструментарий для манипуляции и обработки потоков MPEG Transport Stream.
entrypoints: {}

capabilities:
  - streaming

# Настройки бэкенда, сгруппированные по связкам
config_schema:
  type: object
  properties:
    # ── Основные ──
    binary_path:
      type: string
      title: "Путь к TSDuck (tsp)"
      default: "tsp"
      description: "Путь к исполняемому файлу tsp"
      group: "Основные настройки"

    # ── Сеть (Input) ──
    udp_buffer_size:
      type: integer
      title: "UDP Буфер (байт)"
      minimum: 1024
      maximum: 65536
      default: 4096
      description: "Размер буфера приёма UDP пакетов"
      group: "Прием"
    srt_mode:
      type: string
      title: "Режим SRT"
      enum: ["caller", "listener"]
      default: "caller"
      description: "Режим работы SRT протокола"
      group: "Прием"

    # ── HTTP_TS Pipeline ──
    continuity_check:
      type: boolean
      title: "Контроль целостности"
      default: true
      description: "Проверка непрерывности Sequence Number в TS-пакетах"
      group: "Плеер (HTTP_TS)"
    pcr_bitrate:
      type: integer
      title: "Фикс. битрейт (PCR)"
      minimum: 0
      maximum: 100000000
      default: 0
      description: "Принудительный битрейт (0 = авто)"
      group: "Плеер (HTTP_TS)"

    # ── HLS Pipeline ──
    hls_duration:
      type: integer
      title: "Сегмент HLS (сек)"
      minimum: 1
      maximum: 30
      default: 5
      description: "Длительность одного сегмента (сек)"
      group: "Плеер (HLS)"
    hls_live_segments:
      type: integer
      title: "Окно HLS (файлов)"
      minimum: 1
      maximum: 50
      default: 5
      description: "Максимальное число сегментов в плейлисте"
      group: "Плеер (HLS)"

    # ── Пакетная обработка ──
    extra_plugins:
      type: string
      title: "Доп. плагины"
      default: ""
      description: "Список плагинов через точку с запятой (для экспертов)"
      group: "Обработка"
    override_command:
      type: string
      title: "Кастомная команда"
      default: ""
      description: "Полная строка параметров для tsp (для экспертов)"
      group: "Для экспертов"

# Поддерживаемые форматы и протоколы
formats:
  input_protocols:
    - udp
    - rtp
    - http
    - hls
    - srt
  output_types:
    - hls
    - http_ts
  preview_formats: []

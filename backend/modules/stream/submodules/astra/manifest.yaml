id: astra
name: "Cesbo Astra"
version: "4.4.182-free"
priority: 40
author: Cesbo
description: Модуль для работы с Astra 4.4. Известный и стабильный инструмент для вещания.
entrypoints: {}

capabilities:
  - streaming
  - conversion

config_schema:
  type: object
  properties:
    # ── Система ──
    binary_path:
      type: string
      title: "Путь к Astra"
      default: "/opt/Cesbo-Astra-4.4.-monitor/astra4.4.182"
      description: "Системный путь к исполняемому файлу Astra."
      group: "Система"

    # ── Прием (Input) ──
    http_input_timeout:
      type: integer
      title: "Таймаут входа (сек)"
      minimum: 1
      maximum: 120
      default: 10
      description: "Ожидание ответа от источника."
      group: "Прием (Input)"
    http_input_buffer_size:
      type: integer
      title: "Буфер приема (KB)"
      minimum: 64
      maximum: 8192
      default: 1024
      description: "Размер буфера для входящего потока."
      group: "Прием (Input)"
    ua:
      type: string
      title: "User-Agent"
      default: "Astra"
      description: "Идентификатор клиента для HTTP-запросов."
      group: "Прием (Input)"

    # ── Вещание (Output) ──
    http_port:
      type: integer
      title: "HTTP Порт вещания"
      minimum: 1024
      maximum: 65535
      default: 8100
      description: "Порт для раздачи потоков по HTTP."
      group: "Вещание (Output)"
    http_buffer_size:
      type: integer
      title: "Буфер передачи (KB)"
      minimum: 64
      maximum: 8192
      default: 1024
      description: "Буфер памяти на каждого клиента."
      group: "Вещание (Output)"
    http_buffer_fill:
      type: integer
      title: "Наполнение буфера (KB)"
      minimum: 64
      maximum: 4096
      default: 256
      description: "Объем данных перед началом отдачи."
      group: "Вещание (Output)"
    udp_ttl:
      type: integer
      title: "UDP TTL"
      minimum: 1
      maximum: 255
      default: 32
      description: "Время жизни пакетов для Multicast."
      group: "Вещание (Output)"

    # ── Управление потоком ──
    http_keep_active:
      type: integer
      title: "Таймаут простоя (сек)"
      minimum: -1
      maximum: 3600
      default: 30
      description: "Время до закрытия потока после ухода зрителей (-1 = вечно)."
      group: "Логика вещания"
    channel_timeout:
      type: integer
      title: "Задержка переключения"
      minimum: 0
      maximum: 300
      default: 0
      description: "Пауза перед переходом на резерв (сек)."
      group: "Логика вещания"
    no_reload:
      type: boolean
      title: "Режим No-Reload"
      default: false
      description: "Не перезапускать процесс при изменении состава потока."
      group: "Логика вещания"
    pass_sdt:
      type: boolean
      title: "Проброс SDT"
      default: false
      description: "Передавать описание сервисов без изменений."
      group: "Логика вещания"
    pass_eit:
      type: boolean
      title: "Проброс EIT (EPG)"
      default: false
      description: "Передавать программу передач без изменений."
      group: "Логика вещания"

    # ── MPEG-TS Метаданные ──
    set_pnr:
      type: integer
      title: "PNR (Номер программы)"
      minimum: 0
      maximum: 65535
      default: 0
      description: "Принудительный индекс программы."
      group: "Метаданные MPEG-TS"
    set_tsid:
      type: integer
      title: "TSID (ID потока)"
      minimum: 0
      maximum: 65535
      default: 0
      description: "Принудительный ID транспортного потока."
      group: "Метаданные MPEG-TS"
    service_name:
      type: string
      title: "Название сервиса"
      default: ""
      description: "Название канала, отображаемое в плеере."
      group: "Метаданные MPEG-TS"
    service_provider:
      type: string
      title: "Провайдер"
      default: ""
      description: "Название вещателя (SDT)."
      group: "Метаданные MPEG-TS"

    # ── Дешифрация ──
    biss_key:
      type: string
      title: "BISS Ключ"
      default: ""
      description: "Ключ дешифрации (16 hex-символов)."
      group: "Дешифрация"

    # ── Экспертные настройки ──
    pid_map:
      type: string
      title: "Карта PID-ов"
      default: ""
      description: "Ручной ремаппинг (pmt=100, video=101)."
      group: "Для экспертов"
    pid_filter:
      type: string
      title: "Фильтр PID-ов"
      default: ""
      description: "Список удаляемых PID (через запятую)."
      group: "Для экспертов"
    override_lua:
      type: string
      title: "Кастомный Lua-скрипт"
      default: ""
      description: "Путь к Lua-файлу конфигурации (Advanced)."
      group: "Для экспертов"

# Поддерживаемые форматы и протоколы
formats:
  input_protocols:
    - udp
    - http
    - hls
  output_types:
    - http_ts
    - udp
  preview_formats: []

# Модуль стриминга — Headless-сервис для доставки видеопотоков
id: stream
name: "Стриминг (Ядро и Драйверы)"
version: 1.0.0
description: >-
  Headless-модуль для приёма, конвертации и доставки сетевых медиапотоков
  через различные бэкенды (FFmpeg, VLC, GStreamer, Astra, TSDuck)
  и нативные Python-реализации (proxy, webrtc, preview).
enabled_by_default: true
type: feature

deps: []

entrypoints:
  factory: "backend.modules.stream:create_module"
  router: "backend.modules.stream.api:get_router"
  settings: "backend.modules.stream.config:schema"

# Headless-модуль: нет собственных страниц
# routes: []
# menu: {}

config_schema:
  type: object
  properties:
    # --- Пул воркеров ---
    worker_pool_size:
      type: integer
      title: "Параллельные воркеры"
      minimum: 1
      maximum: 32
      default: 4
      description: "Максимальное количество параллельных процессов стриминга"
      group: "Система"
    worker_timeout:
      type: integer
      title: "Таймаут воркера (сек)"
      minimum: 5
      maximum: 300
      default: 30
      description: "Таймаут ожидания ответа от воркера"
      group: "Система"

    # --- Превью ---
    preview_format:
      type: string
      title: "Формат превью"
      enum: ["jpeg", "png", "webp"]
      default: "jpeg"
      description: "Формат генерации превью по умолчанию"
      group: "Превью"
    preview_width:
      type: integer
      title: "Ширина превью (px)"
      minimum: 64
      maximum: 1920
      default: 640
      description: "Ширина превью в пикселях"
      group: "Превью"
    preview_quality:
      type: integer
      title: "Качество превью"
      minimum: 1
      maximum: 100
      default: 75
      description: "Качество сжатия (для JPEG/WebP)"
      group: "Превью"

    # --- Выбор бэкендов ---
    preferred_stream_backend:
      type: string
      title: "Драйвер вещания"
      default: "auto"
      description: "Предпочтительный драйвер для стриминга. auto = автовыбор"
      group: "Драйверы"
    preferred_preview_backend:
      type: string
      title: "Драйвер превью"
      default: "auto"
      description: "Предпочтительный драйвер для снимков экрана. auto = автовыбор"
      group: "Драйверы"

    # Зависимые (динамические) модули теперь объявляют свои настройки (в том числе пути) в собственных manifest.yaml.

    # --- Сеть ---
    proxy_buffer_size:
      type: integer
      title: "Размер буфера прокси (байт)"
      minimum: 1024
      maximum: 1048576
      default: 65536
      description: "Размер буфера для проксирования потоков"
      group: "Сеть"
    http_timeout:
      type: integer
      title: "Таймаут HTTP (сек)"
      minimum: 1
      maximum: 60
      default: 10
      description: "Таймаут сетевых HTTP подключений"
      group: "Сеть"

hooks: {}
assets:
  cache_dirs: ["cache"]
  data_dirs: ["data"]

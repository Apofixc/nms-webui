id: vlc
parent: stream
name: VLC Backend
version: 1.0.0
priority: 20
author: VideoLAN
description: Резервный бэкенд на базе VLC для стриминга и превью.
entrypoints: {}

capabilities:
  - streaming
  - preview

# Настройки бэкенда, сгруппированные по связкам
config_schema:
  type: object
  properties:
    # ── Основные ──
    binary_path:
      type: string
      title: "Путь к VLC (cvlc)"
      default: "cvlc"
      description: "Путь к исполняемому файлу headless VLC"
      group: "Основные настройки"

    # ── HTTP_TS Pipeline ──
    http_port:
      type: integer
      title: "Порт вещания (HTTP)"
      minimum: 1024
      maximum: 65535
      default: 8080
      description: "Порт для раздачи MPEG-TS потока клиентам"
      group: "Плеер (HTTP_TS)"
    http_mux:
      type: string
      title: "Тип потока"
      enum: ["ts", "ogg", "ps"]
      default: "ts"
      description: "Формат контейнера для HTTP вещания"
      group: "Плеер (HTTP_TS)"

    # ── HLS Pipeline ──
    hls_seglen:
      type: integer
      title: "Сегмент HLS (сек)"
      minimum: 1
      maximum: 30
      default: 5
      description: "Длительность одного сегмента (сек)"
      group: "Плеер (HLS)"
    hls_numsegs:
      type: integer
      title: "Окно HLS (файлов)"
      minimum: 1
      maximum: 50
      default: 5
      description: "Число сегментов в Live-плейлисте"
      group: "Плеер (HLS)"

    # ── Превью Pipeline ──
    scene_ratio:
      type: integer
      title: "Интервал кадров"
      minimum: 1
      maximum: 100
      default: 10
      description: "Интервал захвата кадров (каждый N-ый кадр)"
      group: "Превью"
    scene_run_time:
      type: integer
      title: "Время работы VLC (сек)"
      minimum: 1
      maximum: 30
      default: 5
      description: "Время работы VLC для захвата кадра (сек)"
      group: "Превью"

    # ── Расширенное (Override) ──
    override_http_ts:
      type: string
      title: "Команда HTTP_TS"
      default: ""
      description: "Кастомная строка --sout (для экспертов)"
      group: "Для экспертов"
    override_hls:
      type: string
      title: "Команда HLS"
      default: ""
      description: "Кастомная строка --sout (для экспертов)"
      group: "Для экспертов"

# Поддерживаемые форматы и протоколы
formats:
  input_protocols:
    - http
    - hls
    - udp
    - rtp
    - rtsp
    - rtmp
    - srt
  output_types:
    - http
    - http_ts
    - hls
  preview_formats:
    - jpeg
    - png

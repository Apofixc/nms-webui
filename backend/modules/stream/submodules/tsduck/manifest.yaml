id: tsduck
name: "TSDuck Toolkit"
version: "3.32.0"
priority: 50
author: TSDuck-Team
description: Модуль для анализа и манипуляции MPEG-TS потоками на базе TSDuck.
entrypoints: {}

capabilities:
  - streaming

config_schema:
  type: object
  properties:
    # ── Система ──
    binary_path:
      type: string
      title: "Путь к TSDuck (tsp)"
      default: "tsp"
      description: "Системный путь к исполняемому файлу tsp."
      group: "Система"

    # ── Прием (Input) ──
    udp_buffer_size:
      type: integer
      title: "UDP Буфер (байт)"
      minimum: 1024
      maximum: 65536
      default: 4096
      description: "Размер буфера приёма пакетов."
      group: "Прием (Input)"
    srt_mode:
      type: string
      title: "Режим SRT"
      enum: ["caller", "listener"]
      default: "caller"
      description: "Способ подключения по протоколу SRT."
      group: "Прием (Input)"

    # ── Плеер (HTTP_TS) ──
    continuity_check:
      type: boolean
      title: "Контроль целостности (CC)"
      default: true
      description: "Проверка непрерывности Sequence Number в TS-пакетах."
      group: "Плеер (HTTP_TS)"
    pcr_bitrate:
      type: integer
      title: "Фикс. битрейт (PCR)"
      minimum: 0
      maximum: 100000000
      default: 0
      description: "Принудительный битрейт на выходе (0 = авто)."
      group: "Плеер (HTTP_TS)"

    # ── Плеер (HLS) ──
    hls_duration:
      type: integer
      title: "HLS: Длительность сегмента"
      minimum: 1
      maximum: 30
      default: 5
      description: "Длина одного фрагмента видео (сек)."
      group: "Плеер (HLS)"
    hls_live_segments:
      type: integer
      title: "HLS: Количество сегментов"
      minimum: 1
      maximum: 50
      default: 5
      description: "Размер окна Live-плейлиста."
      group: "Плеер (HLS)"

    # ── Экспертные настройки ──
    extra_plugins:
      type: string
      title: "Дополнительные плагины"
      default: ""
      description: "Список плагинов tsp через точку с запятой (для экспертов)."
      group: "Для экспертов"
    override_command:
      type: string
      title: "Кастомная команда"
      default: ""
      description: "Полная строка параметров для tsp (Advanced)."
      group: "Для экспертов"

# Поддерживаемые форматы и протоколы
formats:
  input_protocols:
    - udp
    - srt
    - http
  output_types:
    - http_ts
    - hls
  preview_formats: []
